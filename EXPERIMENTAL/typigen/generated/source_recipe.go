package generated

import "sort"

// SourceRecipe is source code recipe for generated.go in typical package
type SourceRecipe struct {
	PackageName  string
	Imports      []ImportPogo
	Structs      []StructPogo
	Constructors []string
	MockTargets  []string
	TestTargets  []string
}

func (r SourceRecipe) String() string {

	sort.Strings(r.Constructors)
	sort.Strings(r.MockTargets)
	sort.Strings(r.TestTargets)

	var builder Builder
	builder.Printlnf("// Autogenerated by Typical-Go. DO NOT EDIT\n")
	builder.Printlnf("package %s", r.PackageName)

	for _, importPogo := range r.Imports {
		builder.Printlnf(`import %s "%s"`, importPogo.Alias, importPogo.PackageName)
	}

	for i := range r.Structs {
		builder.Printlnf("%s", r.Structs[i])
	}

	builder.Printlnf("func init() {")
	for i := range r.Constructors {
		builder.Printlnf("Context.AddConstructor(%s)", r.Constructors[i])
	}
	builder.WriteString("\n")
	for i := range r.MockTargets {
		builder.Printlnf("Context.AddMockTarget(\"%s\")", r.MockTargets[i])
	}
	builder.WriteString("\n")
	for i := range r.TestTargets {
		builder.Printlnf("Context.AddTestTarget(\"./%s\")", r.TestTargets[i])
	}
	builder.Printlnf("}")

	return builder.String()
}

// AddConstructorPogos to add FunctionPogo to constructor
func (r *SourceRecipe) AddConstructorPogos(pogos ...FunctionPogo) {
	for _, pogo := range pogos {
		r.Constructors = append(r.Constructors, pogo.String())
	}
}

// AddConstructors to add constructors
func (r *SourceRecipe) AddConstructors(constructors ...string) {
	r.Constructors = append(r.Constructors, constructors...)
}

// AddMockTargets to add constructors
func (r *SourceRecipe) AddMockTargets(mockTargets ...string) {
	r.MockTargets = append(r.MockTargets, mockTargets...)
}

// AddTestTargets to add constructors
func (r *SourceRecipe) AddTestTargets(testTargets ...string) {
	r.TestTargets = append(r.TestTargets, testTargets...)
}

// AddImportPogo to add import POGO
func (r *SourceRecipe) AddImportPogo(pogos ...ImportPogo) {
	r.Imports = append(r.Imports, pogos...)
}
